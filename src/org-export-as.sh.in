#!/bin/bash
#
# org-export-as - Export given org file to given format
#
# It requires org-batch.el (run make)
#
### Examples
#
# org-export-as ascii foo.txt    # => foo.org -> foo.txt
# org-export-as html index.html  # => index.org -> index.html
# org-export-as pdf foo.pdf      # => foo.org -> foo.pdf (and foo.tex)
#
# FIXME: license
#

autorg=%autorg_path%  # from configure

fmt="$1"              # the target format: ascii, html or pdf
case $fmt in          # the target filename: e.g. index.html
    ascii)
        out="${2/.*/.txt}"
	;;
    latex)
        out="${2/.*/.tex}"
	;;
    html|pdf)
        out="${2/.*/.$fmt}"
	;;
    *)
        echo " EE Unknown format: $fmt"
	exit 1
	;;
esac

test -f $autorg/src/org-batch.el || { echo " EE Missing script: org-batch.el"; exit 1; }

org="${out/.*/.org}"  # the org source filename: e.g. index.org
test -f $org || { echo " EE Missing org source: $org"; exit 1; }

### Export file

emacs -no-site-file -q -batch -l $autorg/src/org-batch.el \
      --visit $org -f org-export-as-$fmt > $out

echo " II Exported $org to $out"
